name: Build and Release

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€vå¼€å¤´çš„æ ‡ç­¾æ—¶è§¦å‘ï¼Œå¦‚v1.0.0
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'

permissions:
  contents: write  # å…è®¸åˆ›å»ºreleaseå’Œä¸Šä¼ æ–‡ä»¶

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build executable
      run: |
        pyinstaller --onefile --windowed --name "SrtToAssConverter" --hidden-import=opencc --hidden-import=pysubs2 --hidden-import=requests --collect-all=opencc toAss_standard_qt.py
        
    - name: Get version
      id: get_version
      run: |
        if ("${{ github.event_name }}" -eq "workflow_dispatch") {
          $version = "${{ github.event.inputs.version }}"
        } else {
          $version = "${{ github.ref_name }}"
        }
        echo "version=$version" >> $env:GITHUB_OUTPUT
        echo "Version: $version"
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.get_version.outputs.version }}
        name: SRTè½¬ASSè½¬æ¢å™¨ ${{ steps.get_version.outputs.version }}
        body: |
          ## ğŸ‰ SRTè½¬ASSå­—å¹•è½¬æ¢å™¨ ${{ steps.get_version.outputs.version }}

          ### âœ¨ ä¸»è¦åŠŸèƒ½
          - ğŸ”„ SRTå­—å¹•æ–‡ä»¶è½¬æ¢ä¸ºASSæ ¼å¼
          - ğŸ¨ è‡ªå®šä¹‰å­—å¹•æ ·å¼å’Œé¢œè‰²
          - ğŸŒ æ”¯æŒç¹ä½“ä¸­æ–‡è½¬ç®€ä½“ä¸­æ–‡
          - âš™ï¸ å¤šç§å­—å¹•é…ç½®é€‰é¡¹
          - ğŸ“ æ‰¹é‡æ–‡ä»¶å¤„ç†

          ### ğŸ“¥ ä¸‹è½½è¯´æ˜
          - **Windowsç”¨æˆ·**: ä¸‹è½½ `SrtToAssConverter.exe`
          - **å•æ–‡ä»¶ç‰ˆæœ¬**: æ— éœ€å®‰è£…ï¼Œç›´æ¥è¿è¡Œ
          - **åŒ…å«æ‰€æœ‰ä¾èµ–**: æ— éœ€é¢å¤–å®‰è£…Pythonæˆ–å…¶ä»–åº“

          ### ğŸš€ ä½¿ç”¨æ–¹æ³•
          1. ä¸‹è½½å¹¶è¿è¡Œ `SrtToAssConverter.exe`
          2. æ·»åŠ SRTå­—å¹•æ–‡ä»¶
          3. é…ç½®å­—å¹•æ ·å¼ï¼ˆå¯é€‰ï¼‰
          4. ç‚¹å‡»"å¼€å§‹è½¬æ¢"

          ### ğŸ”§ ç³»ç»Ÿè¦æ±‚
          - Windows 10/11 (64ä½)
          - æ— éœ€å®‰è£…Pythonç¯å¢ƒ

          ---

          **æ„å»ºæ—¶é—´**: ${{ github.run_id }}
          **æ„å»ºç¯å¢ƒ**: Windows + Python 3.11
        files: |
          dist/SrtToAssConverter.exe
        draft: false
        prerelease: false
